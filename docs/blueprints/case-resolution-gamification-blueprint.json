{"success": [{"id": "struct_4", "level": "error", "description": "Every Genesys Cloud blueprint should have a blueprint/index.md that contains a complete writeup in Markdown of the blueprint."}, {"id": "link_0", "level": "error", "description": "Image links in the README.md file should point to a valid image file.", "fileHighlights": [{"path": "README.md", "lineNumber": 9, "lineCount": 1, "lineContent": "![Flowchart for the blueprint](blueprint/images/salesforce-gamificaton.png \"Flowchart\")"}]}, {"id": "struct_0", "level": "error", "description": "All Genesys Cloud blueprints must include a README.MD file.  This file should contain a brief introduction of the blueprint."}, {"id": "struct_1", "level": "error", "description": "Every Genesys Cloud blueprint should have a blueprint directory at the root of the project.  This directory should hold all assets associated with the blueprint."}, {"id": "content_10", "level": "error", "description": "The index.md should have a  '## Additional resources' section containing the project files section.  This section should include any additional links that will be useful for the blueprint.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 269, "lineCount": 1, "lineContent": "## Additional resources"}]}, {"id": "struct_2", "level": "error", "description": "Every Genesys Cloud blueprint should have a blueprint/images directory that will contain all of the image assets for a project."}, {"id": "struct_3", "level": "error", "description": "Every Genesys Cloud blueprint should have a overview.png file that contains a high-level architecture diagram for the blueprint."}, {"id": "content_2", "level": "error", "description": "The index.md file's front matter must include the following fields: title, author, indextype, icon, image, category, and summary", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 2, "lineCount": 1, "lineContent": "title: Integrate a Salesforce metric to Genesys Cloud's Gamification system"}, {"path": "blueprint/index.md", "lineNumber": 3, "lineCount": 1, "lineContent": "author: prince.merluza"}, {"path": "blueprint/index.md", "lineNumber": 4, "lineCount": 1, "lineContent": "indextype: blueprint"}, {"path": "blueprint/index.md", "lineNumber": 5, "lineCount": 1, "lineContent": "icon: blueprint"}, {"path": "blueprint/index.md", "lineNumber": 6, "lineCount": 1, "lineContent": "image:"}, {"path": "blueprint/index.md", "lineNumber": 7, "lineCount": 1, "lineContent": "category: 3"}, {"path": "blueprint/index.md", "lineNumber": 8, "lineCount": 1, "lineContent": "summary: This Genesys Cloud Developer Blueprint provides a Gamification integration between Salesforce and Genesys Cloud"}]}, {"id": "content_3", "level": "error", "description": "The index.md must have a '## Scenario' section describing the problem the blueprint is trying to solve.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 22, "lineCount": 1, "lineContent": "## Scenario"}]}, {"id": "content_4", "level": "error", "description": "The index.md must have a '## Solution' section describing how blueprint solves the project.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 26, "lineCount": 1, "lineContent": "## Solution"}]}, {"id": "link_2", "level": "error", "description": "Image links in the README.md file is missing alternative text.", "fileHighlights": []}, {"id": "link_1", "level": "error", "description": "Image links in index.md file should point to a valid image file.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 20, "lineCount": 1, "lineContent": "![Flowchart for the blueprint](./images/salesforce-gamificaton.png \"Flowchart\")"}, {"path": "blueprint/index.md", "lineNumber": 94, "lineCount": 1, "lineContent": "![Enable Gamification](./images/enable_gamification.png \"Enable Gamification\")"}, {"path": "blueprint/index.md", "lineNumber": 103, "lineCount": 1, "lineContent": "    ![External Metric Configuration](./images/new_external_metric.png \"External Metric Configuration\")"}, {"path": "blueprint/index.md", "lineNumber": 129, "lineCount": 1, "lineContent": "![New Custom User field](./images/new_custom_field.png \"New Custom User field\")"}, {"path": "blueprint/index.md", "lineNumber": 231, "lineCount": 1, "lineContent": "![Create new flow](./images/create_new_flow.png \"New Custom User Field\")"}, {"path": "blueprint/index.md", "lineNumber": 233, "lineCount": 1, "lineContent": "![Flow configuration](./images/flow_configuration.png \"Flow configuration\")"}, {"path": "blueprint/index.md", "lineNumber": 245, "lineCount": 1, "lineContent": "    ![Flow overview](./images/flow_overview.png \"Flow overview\")"}, {"path": "blueprint/index.md", "lineNumber": 261, "lineCount": 1, "lineContent": "![Developer console](./images/dev_console.png \"Developer console\")"}]}, {"id": "content_7", "level": "error", "description": "The index.md file should have '### Specialized knowledge' section that enumerates the skill sets that the implementor should possess in order to carry out the blueprint.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 41, "lineCount": 1, "lineContent": "### Specialized knowledge"}]}, {"id": "content_6", "level": "error", "description": "The index.md file must have a '## Prerequisites' section that describes the skillset and technical requirements an individual must have to successfully install the blueprint.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 39, "lineCount": 1, "lineContent": "## Prerequisites"}]}, {"id": "content_8", "level": "error", "description": "The index.md file should have a '## Implementation steps' section that enumerates the steps necessary to carry out the blueprint implementation.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 88, "lineCount": 1, "lineContent": "## Implementation steps"}]}, {"id": "content_1", "level": "error", "description": "The front matter must be defined in the file or the blueprint will not appear in the Developer Center", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 1, "lineCount": 236, "lineContent": "---\ntitle: Integrate a Salesforce metric to Genesys Cloud's Gamification system\nauthor: prince.merluza\nindextype: blueprint\nicon: blueprint\nimage:\ncategory: 3\nsummary: This Genesys Cloud Developer Blueprint provides a Gamification integration between Salesforce and Genesys Cloud\n---\n:::{\"alert\":\"primary\",\"title\":\"About Genesys Cloud Blueprints\",\"autoCollapse\":false} \nGenesys Cloud blueprints were built to help you jump-start building an application or integrating with a third-party partner. \nBlueprints are meant to outline how to build and deploy your solutions, not a production-ready turn-key solution.\n \nFor more details on Genesys Cloud blueprint support and practices \nplease see our Genesys Cloud blueprint [FAQ](https://developer.genesys.cloud/blueprints/faq)sheet.\n:::\n\nThis Genesys Cloud Developer Blueprint demonstrates how to configure external metrics in Genesys Cloud and how to use the Gamification API to update the external metric values from Salesforce or any third-party system.\n\n![Flowchart for the blueprint](./images/salesforce-gamificaton.png \"Flowchart\")\n\n## Scenario\n\nAn organization using the Gamification features of Genesys Cloud wants to add external metrics to score and rank their agents.\n\n## Solution\n\nThe blueprint uses the Salesforce metric that tracks the average number of days a user takes to resolve a case.\n\nYou can use this solution with any other metric or with any third-party system and invoke the Gamification API to send daily value updates.\n\n## Solution components\n\n* **Genesys Cloud** - A suite of Genesys cloud services for enterprise-grade communications, collaboration, and contact center management. In this solution, you need a Genesys Cloud user account and Genesys Cloud for Salesforce integration.\n* **Salesforce** - The Salesforce Cloud Customer Relationship Management (CRM) platform.\n* **Genesys Cloud for Salesforce managed package** - The managed package contains all the installation components, including the Genesys Cloud for Salesforce SDK that is necessary to run Genesys Cloud for Salesforce.\n* **Genesys Cloud for Salesforce SDK** - Allows you to customize actions in Genesys Cloud for Salesforce. The managed package includes the SDK and uses the Salesforce Apex programming language.\n\n## Prerequisites\n\n### Specialized knowledge\n\n* Administrator-level knowledge of Genesys Cloud\n* Administrator-level knowledge of Salesforce and programming experience with Apex code\n\n### Genesys Cloud account requirements\n\n* A Genesys Cloud license. For more information, see [Genesys Cloud Pricing](https://www.genesys.com/pricing \"Opens the Genesys Cloud pricing page\").\n* [Genesys Cloud 3 license](https://www.genesys.com/pricing \"Genesys Cloud 3 license\") or [Genesys Cloud User 1 WEM Upgrade II](https://appfoundry.genesys.com/filter/genesyscloud/listing/814c259b-7e36-48e6-b6d2-5355b4146227 \"Genesys Cloud User 1 WEM Upgrade II\") or [Genesys Cloud User 2 WEM Upgrade I](https://appfoundry.genesys.com/filter/genesyscloud/listing/253f2cbb-5f9d-4349-a54e-1e8dd4a0f8a5 \"Genesys Cloud User 2 WEM Upgrade I\").\n* Master Admin role in Genesys Cloud. For more information, see [Roles and permissions overview](https://help.mypurecloud.com/?p=24360 \"Opens the Roles and permissions overview article\") in the Genesys Cloud Resource Center.\n* An OAuth client with roles that are assigned with the Gamification permissions. For more information, see [OAuth client permissions for Genesys Cloud for Salesforce](https://help.mypurecloud.com/?p=188903 \"Opens the OAuth client permissions for Genesys Cloud for Salesforce article\") and [Create an OAuth client](https://help.mypurecloud.com/?p=188023 \"Opens the Create an OAuth client article\") in the Genesys Cloud Resource Center.\n\n### Salesforce account requirements\n\n* A Salesforce organization with the Genesys Cloud for Salesforce integration installed and configured. For more information, see [Install or upgrade the Genesys Cloud for Salesforce managed package](https://help.mypurecloud.com/?p=39356/ \"Goes to the Install or upgrade the Genesys Cloud for Salesforce managed package article\") and [Set up a call center in Salesforce](https://help.mypurecloud.com/?p=10593 \"Goes to the Set up a call center in Salesforce article\") in the Genesys Cloud Resource Center.\n* The solutions engineer must be assigned a System Administrator profile. For more information, see [Standard Profiles](https://help.salesforce.com/s/articleView?id=sf.standard_profiles.htm&type=5 \"Opens the Standard Profiles page\") in the Salesforce documentation.\n\n## Gamification API\n\nBefore implementing the sample, learn about the [Write External Metric Data API endpoint](https://developer.genesys.cloud/devapps/api-explorer#post-api-v2-employeeperformance-externalmetrics-data \"Goes to the API Explorer Gamification API page\"). This API allows you to update the daily value of an external metric.\n\nThe sample body of the API:\n\n```JSON\n{\n    \"items\": [\n        {\n            \"metricId\": \"aaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa\",\n            \"userId\": \"zzzzzzz-zzzz-zzzz-zzzz-zzzzzzzzzzzz\",\n            \"dateOccurred\": \"2022-08-29\",\n            \"value\": 300,\n            \"count\": 20\n        }\n    ]   \n}\n```\n\n* `items` is an array that contains the update to a specific metric for a specific user. To update multiple metrics or multiple users, add multiple items in the array.\n\n* `dateOccurred` is the date of recording the specific metric value. You can set this date to be between 7 days in the past and 30 days ahead of the current date. If you invoke the API on the same date that you have added in the API, then the API overrides the `value` and `count` properties. Since the `value` data does not automatically accumulate, the data is pre-aggregated and finalized in the external system whenever the API is invoked.\n\n* `value` is the numeric value that represents the metric. In the sample API, it represents the number of days it took to resolve the cases.\n\n* `count` is the number of data points. In the sample API, it is the number of cases resolved on the day.\n\nUsing this API information to update a metric externally, you can now create an automated way in Salesforce to send these updates to Genesys Cloud.\n\n## Implementation steps\n\n### Turn on Gamification settings on Genesys Cloud\n\nBy default, Gamification is turned off for an organization. To turn it on in Genesys Cloud, navigate to **Admin > Performance & Engagement > Gamification Settings** and enable the **Gamification** toggle.\n\n![Enable Gamification](./images/enable_gamification.png \"Enable Gamification\")\n\n### Create an external metric in Genesys Cloud\n\nTo create an external metric in Genesys Cloud:\n\n1. Navigate to **Admin > Performance & Engagement > External Metric Definitions**.\n2. Enter the external metric details as shown in the illustration:\n\n    ![External Metric Configuration](./images/new_external_metric.png \"External Metric Configuration\")\n\n3. Click **Save Metric**.\n4. Note the **External ID** for later use in the Salesforce configuration.\n\nFor more information, see [Configure external metrics for performance scorecards](https://help.mypurecloud.com/articles/configure-external-metrics-for-performance-scorecards/ \"Goes to the Configure external metrics for performance scorecards article\") in the Genesys Cloud Resource Center.\n\n### Add the metric to a Gamification profile\n\nCreate a Gamification profile or use an existing profile and add the external metric that you created to it.\n\nTo create or edit a profile in Genesys Cloud:\n\n1. Navigate to **Admin > Performance & Engagement > Gamification Profiles**.\n2. Create or edit an existing profile.\n3. Under the **Metrics** tab, add the metric that you created.\n4. To get the number of days an agent takes to close a case, edit the metric and select **Lower is Better** in the **Objective Type** list for the metric.\n\n### Create a custom user field in Salesforce to associate with Genesys Cloud User Id\n\nTo associate the users in Salesforce with their Genesys Cloud user accounts, create a custom field for the user mapping in Salesforce.\n\nFor more information, see [Create Custom Fields](https://help.salesforce.com/s/articleView?id=sf.adding_fields.htm&type=5 \"Opens the Create Custom Fields page\") in the Salesforce documentation.\n\nIn this solution, the custom field is named `Genesys_Cloud_User_Id` for consistency, and the maximum length is set to 36 to match the Genesys Cloud User Id length in the UUID format.\n\n![New Custom User field](./images/new_custom_field.png \"New Custom User field\")\n\n### Create the Apex class for processing the metric\n\n1. From the Salesforce setup, create a new [Apex class](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_qs_class.htm \"Goes to the Adding an Apex Class section in Salesforce documentation\").\n2. In the class editor, enter the following Apex script:\n\n    ```Java\n    public class GenesysCloudGamification {\n        \n        // Execute the event of calling Genesys Cloud API to update metric values\n        @InvocableMethod (label = 'Generate Genesys Cloud Metric')\n        public Static void createEvent(List<GCCXMetricFlowInput> attributes) {\n            GCCXMetricFlowInput input = attributes[0];\n            string metricId = input.metricId;\n            string gcUserId = input.gcUserId;\n            string sfdcUserId = input.sfdcUserId;\n            Date closed = Date.today();\n            \n            List<object> metrics = getMetrics(sfdcUserId);\n            \n            // Build the request body\n            JSONGenerator gen = JSON.createGenerator(true);\n            gen.writeStartObject();\n            gen.writeFieldName('items');\n            gen.writeStartArray();\n            gen.writeStartObject();\n            gen.writeStringField('metricId', metricId);\n            gen.writeStringField('userId', gcUserId);\n            gen.writeStringField('dateOccurred', formatDate(closed));\n            gen.writeNumberField('count', (Integer)metrics[0]);\n            gen.writeNumberField('value', (Integer)metrics[1]);\n            gen.writeEndObject();\n            gen.writeEndArray();\n            gen.writeEndObject();\n            \n            // Invoke the GC API\n            System.debug('Calling Genesys Cloud API with body: ' + gen.getAsString());\n            HttpResponse response = purecloud.SDK.Rest.post('/api/v2/employeeperformance/externalmetrics/data', gen.getAsString());\n            System.debug(response.getBody());\n        }\n        \n        // Format Date to yyyy-mm-dd\n        private static string formatDate(Date occurred) {\n            integer intDay = occurred.day();\n            integer intMonth = occurred.month();\n            integer intYear = occurred.year();\n            string day = String.valueOf(intDay);\n            string month = String.valueOf(intMonth);\n            string year = String.valueOf(intYear);\n            \n            if (intMonth < 10) {\n                month = '0' + month;\n            }\n            \n            return year + '-' + month + '-' + day;\n        }\n        \n        // Get the total days before case resolution and the count of cases closed today.\n        public static List<object> getMetrics(String sfdcUserId){\n            Date closed = Date.today();\n            List<Case> closedCases;\n            List<object> metrics = New List<object>();\n            try {\n                closedCases = [SELECT CreatedDate FROM Case WHERE ClosedDate = LAST_N_DAYS:1 AND OwnerId = :sfdcUserId];\n            }\n            catch (DmlException e) {\n                System.debug('getMetrics error: ' + e.getMessage());\n            }\n            integer count = closedCases.size();\n            integer totalDays = 0;\n            for (integer x=0; x<count; x++) {\n                date created = date.newInstance(closedCases[x].CreatedDate.year(), closedCases[x].CreatedDate.month(), closedCases[x].CreatedDate.day());\n                totalDays += created.daysBetween(closed);\n            }\n            \n            metrics.add(count);\n            metrics.add(totalDays);\n            return metrics;\n        }\n        \n        // Input data for the invocable method\n        public class GCCXMetricFlowInput {\n        @InvocableVariable(label='Metric ID' description='The Genesys Cloud Custom Metric ID' required=true)\n        public string metricId;\n        \n        @InvocableVariable(label='Genesys Cloud User ID' description='The ID of the Genesys Cloud User' required=true)\n        public string gcUserId;\n        \n        @InvocableVariable(label='SFDC User ID' description='The ID of the SFDC User' required=true)\n        public string sfdcUserId;\n        }\n    }\n    ```\n3. Save the Apex class.\n\n### Create an automated flow in Salesforce using the Flow Builder\n\nUsing the Flow Builder, create a flow that automatically runs whenever a Salesforce user resolves or closes a case.\n\n1. From the Salesforce setup, create a new [flow](https://help.salesforce.com/s/articleView?id=sf.flow_build.htm&type=5 \"Goes to the Build a Flow section page in Salesforce\").\n2. Select **Record-Triggered Flow** as the flow type.\n![Create new flow](./images/create_new_flow.png \"New Custom User Field\")\n1. Configure the flow with the settings shown in the following illustration:\n![Flow configuration](./images/flow_configuration.png \"Flow configuration\")\n4. For the flow to run asynchronously, add the **Generate Genesys Cloud Metric** action and fill the following details for the action:\n    | Field                 | Value                                                     |\n    |-----------------------|-----------------------------------------------------------"}]}, {"id": "link_3", "level": "error", "description": "Image links in the index.md file is missing alternative text.", "fileHighlights": []}], "failed": [{"id": "content_0", "level": "error", "description": "Overview image should be referred to in README.MD", "fileHighlights": []}, {"id": "content_5", "level": "error", "description": "The index.md must have a '## Content' section linking to the rest of the document.", "fileHighlights": []}, {"id": "link_4", "level": "error", "description": "Hyperlinks in the README.md file is missing alternative text.", "fileHighlights": [{"path": "README.md", "lineNumber": 7, "lineCount": 1, "lineContent": "You can view the complete blueprint and download the sample files from [here](./blueprint)."}]}, {"id": "content_9", "level": "error", "description": "The index.md file should have a '### Download the repository containing the project files' section that describe how to clone the blueprint repository from GitHub.", "fileHighlights": []}, {"id": "link_5", "level": "error", "description": "Hyperlinks in the index.md file is missing alternative text.", "fileHighlights": [{"path": "blueprint/index.md", "lineNumber": 15, "lineCount": 1, "lineContent": "please see our Genesys Cloud blueprint [FAQ](https://developer.genesys.cloud/blueprints/faq)sheet."}]}], "timestamp": "2024-02-13T16:26:02Z"}